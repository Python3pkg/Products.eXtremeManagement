<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      i18n:domain="eXtremeManagement"
      metal:use-macro="here/main_template/macros/master">

    <head>
        <metal:block fill-slot="top_slot"
                     tal:define="dummy python:request.set('disable_border', 1)" />
    </head>

    <body>

    <tal:main metal:fill-slot="main">

        
         <tal:year define="view context/@@yearbookings;
                           main view/main;
                           base_year main/base_year;
                           base_month main/base_month;
                           global total_yearly python: 0;">
                          
             <p tal:define="contextlink string:${here/absolute_url}/${template/id}">
                <span>Go to <a
                tal:attributes="href string:${contextlink}?base_year=${main/prev_year}">previous</a></span>
    
                <span tal:condition="main/display_next_year"> or <a
                 tal:attributes="href string:${contextlink}?base_year=${main/next_year}">next</a></span> 12 months.
             </p>

             <tal:month tal:repeat="month_info view/months_list">
                <tal:one_month
                    tal:define="global total_monthly python: 0;
                                month month_info/month;
                                year month_info/year;
                                bookings month_info/bookings;"
                           tal:condition="bookings">
                    <h4 tal:content="string:Bookings for the month $month/$year">
                       Bookings for mm/yy
                    </h4>
                           
                    
                    <table border="1" 
                           class="listing" 
                           with="100%">
                        <tr>
                            <th i18n:translate="listingheader-date">
                                Date
                            </th>
                            <th i18n:translate="listingheader-time">
                                Time
                            </th>
                        </tr>
                    
                        <tr tal:repeat="booking bookings">
                        <tal:booking tal:define="date python:booking[0];
                                               time python:booking[1];
                                               daily_total python: time.split(':');
                                               global total_monthly python: total_monthly+int(daily_total[0])+int(int(daily_total[1])/60)">
                            <td tal:content="python:toLocalizedTime(date)">
                                2006-01-25
                            </td>
                            <td tal:content="time">
                                4:45
                            </td>
                        </tal:booking>
                        </tr>
                        <tr>
                           <th>Total</th>
                           <th tal:content="total_monthly" />
                        </tr>
                    </table>
                </tal:one_month>
                <tal:sum define="global total_yearly python: total_yearly+total_monthly" />
            </tal:month>
            <p>Total for the entire period: <span tal:replace="total_yearly" /> hours.</p>
        </tal:year>
    </tal:main>
    </body>
</html>

