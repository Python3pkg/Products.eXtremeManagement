<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      i18n:domain="eXtremeManagement"
      metal:use-macro="here/main_template/macros/master">

    <head>
        <metal:block fill-slot="top_slot"
                     tal:define="dummy python:request.set('disable_border', 1)" />
    </head>

    <body>

    <div metal:fill-slot="main"
         tal:define="projects python:here.portal_catalog.searchResults(portal_type='Project');"
         tal:omit-tag="">

        <h1 i18n:translate="header_project_administration" 
            class="documentFirstHeading">
            Project administration
        </h1>

        <tal:block tal:condition="projects">
  
            <p class="discreet" 
                i18n:translate="description_project_administration"> 
                This is a list of all projects. Also the iterations which are completed with state, estimated and actual time.
                Once an iteration is completed and invoiced, the status can be changed to <strong>Invoiced</strong>. 
                This way the administration has an overview with all iterations which are invoiced.
            </p>

            <table class="listing"
                   border="1" 
                   width="100%"
                   cellpadding="0" 
                   cellspacing="0">
                    
                <tr>
                    <th i18n:translate="listingheader_projects">Project</th>
                </tr>

                <tr tal:repeat="project projects">
                    <td class="td-project">
                        <a tal:attributes="href string:${project/getURL}" 
                        class="project_title"
                        tal:content="project/Title">
                        Title
                        </a>
                        <div class="project_description" 
                             tal:content="project/Description">Description</div>
                      
                        <table width="95%" 
                               cellpadding="0"
                               cellspacing="3"
                               class="iteration-table"
                               tal:define="project_path python:'/'.join(project.getObject().getPhysicalPath()); 
                                         iterations python:here.portal_catalog.searchResults(portal_type='Iteration', review_state=['completed', 'invoiced'], path=project_path);"
                               tal:condition="iterations"> 

                            <tr class="iteration-table-header">
                                <th width="50%"
                                    i18n:translate="listingheader_iteration">Iteration</th>
                                <th width="20%" 
                                    i18n:translate="listingheader_state">Status</th>
                                <th width="15%" 
                                    i18n:translate="listingheader_estimate">Estimate</th>
                                <th width="15%" 
                                    i18n:translate="listingheader_actual">Actual</th>
                            </tr>
                      
                            <tr tal:repeat="iteration iterations"
                                class="project-list-info">
                                <tal:block tal:define="iterationObj iteration/getObject;">
                                <td class="td-story-title">
                                    <img alt="" 
                                        height="16" 
                                        width="16"
                                        tal:attributes="src string:${here/portal_url}/${iteration/getIcon};" /> 
                                    <a tal:attributes="href string:${iteration/getURL}"
                                       tal:content="iteration/Title">
                                        Title
                                    </a> 
                                </td>
                            
                                <td tal:content="iteration/review_state">state</td>
                                <td tal:define="iterationObj iteration/getObject;
                                                projectEstimate python:iterationObj.getEstimate()"
                                    tal:content="projectEstimate">Estimate</td>
                                <td tal:define="iterationObj iteration/getObject; 
                                                projectActual python:iterationObj.getActualHours()"
                                    tal:content="projectActual">actual</td>
                                </tal:block>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>
        </tal:block>

        <p tal:condition="not:projects" 
           class="discreet" 
           i18n:translate="no_projects_found">No projects are published yet!</p>

    </div>
    </body>
</html>
