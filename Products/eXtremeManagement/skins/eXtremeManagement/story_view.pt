<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="eXtremeManagement">

  <body>
  <div metal:fill-slot="main">
    <div metal:define-macro="body"
         tal:define="view context/@@story;
                     story view/main;
                     tasklist view/tasks;
                     items tasklist/tasks;
                     totals tasklist/totals;
                     next story/next;
                     prev story/prev;">

      <metal:prevnext define-macro="previous_next">
        <div class="listingBar" tal:condition="python: next or prev">
          <a class="listingNext"
             title=""
             tal:condition="python:next"
             tal:attributes="href next/getURL;
                             title next/Title;"
             tabindex="1"
             href="">
            <span i18n:translate="next">Next</span>
            <img tal:replace="structure here/arrowRight.gif" />
          </a>
          <a class="listingPrevious"
             tal:condition="python:prev"
             title=""
             tal:attributes="href prev/getURL;
                             title prev/Title;"
             tabindex="1"
             href="">
            <img tal:replace="structure here/arrowLeft.gif" />
            <span i18n:translate="previous">Previous</span>
          </a>
          &nbsp;
        </div>
      </metal:prevnext>


      <metal:define define-macro="details"
                    tal:define="view context/@@story;
                                story view/main;
                                tasklist view/tasks;
                                items tasklist/tasks;
                                totals tasklist/totals">
      <div class="documentDescription"
           tal:condition="story/description"
           tal:content="story/description">
        description
      </div>

      <div tal:replace="structure story/cooked_body" />

      <p tal:condition="story/rough_estimate"
         i18n:translate="label_roughestimate">
        Rough Estimate:
        <span i18n:name="rough" tal:replace="structure story/rough_estimate" />
        days.
      </p>

      <tal:block tal:condition="items"
                 tal:define="show_story python:False;">
        <h1 class="documentFirstHeading" 
            i18n:translate="heading_tasks">Tasks</h1>
        
        <metal:block metal:define-macro="tasklist_table">
          <table class="listing nosort"
                 border="1"
                 width="100%"
                 cellpadding="0" 
                 cellspacing="0">
            <thead>
              <tr>
                <th i18n:translate="listingheader_story"
                    tal:condition="show_story">Story</th>
                <th i18n:translate="listingheader_title">Title</th>
                <th i18n:translate="listingheader_estimate">Estimate</th>                  
                <th i18n:translate="listingheader_actual">Actual</th>
                <th i18n:translate="listingheader_diff">Difference</th>
                <th i18n:translate="listingheader_state">Status</th>
                <th i18n:translate="listingheader_assignees">Assignee(s)</th>
              </tr>
            </thead>


            <tr tal:repeat="task items"
                class="list-in-iteration">
              <tal:story condition="show_story">
                <tal:comment replace="nothing">
                  This part is also used in other templates via a
                  metal macro, so we have to get the story url and
                  title from the task items and not from the context
                  or view/main.
                </tal:comment>
                <td class="td-story-title">
                  <a tal:attributes="href task/story_url"
                     tal:content="task/story_title" />
                </td>
              </tal:story>
              <td class="td-story-title">
                <a tal:attributes="href task/url"
                   tal:content="task/title" />
              </td>
              <td tal:content="task/estimate" />
              <td tal:content="task/actual" />
              <td tal:content="task/difference" />
              <td tal:content="task/review_state_title"
                  i18n:domain="plone"
                  i18n:translate=""
                  class=""
                  tal:attributes="class python:'td-center state-'+normalizeString(task['review_state'])" />
              <td class="td-center">
                <tal:assignees tal:repeat="employee task/assignees">
                  <img tal:replace="structure context/user.gif" />
                  <span tal:replace="employee">Assignee</span>
                  <br />
                </tal:assignees>
              </td>
            </tr>
            
            <tr id="totalTasks">
              <th class="td-story-title" 
                  tal:attributes="colspan python:test(show_story, 2, 1)"
                  i18n:translate="total">
                Total
              </th>
              <th tal:content="totals/estimate" />
              <th tal:content="totals/actual" />
              <th tal:content="totals/difference" />
              <th colspan="2">&nbsp;</th>
            </tr>
          </table>
        </metal:block>
      </tal:block>
      
      <p class="discreet"
         tal:condition="python: not items"
         i18n:translate="no_tasks_defined">
        No tasks defined yet.
      </p>
      <br />
      </metal:define>
    </div>

    <metal:block metal:define-macro="folderlisting" />
  </div>
  </body>
</html>
