<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      i18n:domain="eXtremeManagement">
  <metal:block use-macro="context/global_defines/macros/defines" />

  <body>
    <metal:block metal:define-macro="header">
       <h1 tal:content="here/title_or_id" class="documentFirstHeading">
         Title or id
       </h1>
       <div class="documentDescription" 
            tal:condition="here/Description" 
            tal:content="here/Description">description
       </div>
       <link REL="stylesheet" TYPE="text/css" href="eXtreme.css" />
    </metal:block>

    <metal:block metal:define-macro="body"
         tal:define="totalEstimate python:here.getTotalEstimate();
                     totalActual python:here.getTotalActual();
                     item_path python:'/'.join(context.getPhysicalPath());
                     items python:here.portal_catalog.searchResults(portal_type='Task', path=item_path);">

        <div class="stx" tal:replace="structure here/CookedBody">
            body text
        </div>

        <div>

        <tal:block tal:condition="items">

          <h1 class="documentFirstHeading" 
              i18n:translate="heading_tasks">Tasks</h1>

          <table class="listing nosort"
                 border="1"
                 width="100%"
                 cellpadding="0" cellspacing="0">

             <thead>
               <tr>
                 <th i18n:translate="listingheader_id">id</th>
                 <th i18n:translate="listingheader_title">Title</th>
                 <th i18n:translate="listingheader_estimate">Estimate</th>                  
                 <th i18n:translate="listingheader_actual">Actual</th>
                 <th i18n:translate="listingheader_diff">Difference</th>
                 <th i18n:translate="listingheader_state">Status</th>
                 <th i18n:translate="listingheader_assignees">Assignee(s)</th>
               </tr>
             </thead>

               <tr tal:repeat="item items">
                <div tal:define="taskObj item/getObject;">
                 <td>
                   <span tal:omit-tag="" tal:content="taskObj/id">id</span></td>
                 <td>
                   <a href=""
                      tal:attributes="href string:${taskObj/absolute_url}">
                      <span tal:content="taskObj/title">Title</span></a></td>
                 <td id="td-estimate" 
                     tal:content="taskObj/get_estimate_formatted">estimate</td>

                 <td id="td-actual"
                     tal:content="taskObj/get_actual_hours_formatted">actual</td>
                 <td id="td-diff" 
                     tal:content="taskObj/get_difference_formatted">diff</td>
                     
                 <td tal:define="wtool here/portal_workflow;
                                 review_state python:wtool.getInfoFor(taskObj, 'review_state')"
                     tal:content="review_state" i18n:translate="">Status</td>
                 <td>
                   <span tal:omit-tag="" tal:repeat="newItem taskObj/getAssignees">
                     <img src="user.gif"/>
                     <span tal:omit-tag="" tal:content="newItem">Assignee</span><br />
                   </span>
                 </td>
                 
                </div>
               </tr>

               <tr class="totalTasks">
                 <td id="total" i18n:translate="total">Total</td>
                 <td id="total-estimate"
                     tal:content="totalEstimate">total estimate</td>
                 <td id="total-actual"
                     tal:content="totalActual">total actual</td>
                 <td id="total-diff" 
                     tal:content="here/getTotalDifference">total diff</td>
                 <td>&nbsp;</td>  
                 <td>&nbsp;</td>  
               </tr>

          </table>
        </tal:block>
        </div> 
   
        <p class="discreet"
           tal:condition="python: not items"
           i18n:translate="no_tasks_defined">No tasks defined yet.
        </p>

        <br />
        <div tal:define="content_items python:here.contentValues('Document')"
             tal:condition="content_items">
           <h1 i18n:translate="heading-contents" 
               class="documentFirstHeading">Contents
           </h1>
           
           <tal:block tal:repeat="item content_items"><strong>
              <a href=""
                 tal:attributes="href string:${item/absolute_url}">
                 <span tal:content="item/title_or_id">Title</span>
              </a></strong>

              <div class="discreet"
                   tal:condition="here/Description" 
                   tal:content="item/Description">description
              </div><br />
           </tal:block>
        </div>
        
    </metal:block>
    <metal:block metal:define-macro="folderlisting" />
  </body>
</html>
