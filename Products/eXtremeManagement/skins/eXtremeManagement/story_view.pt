<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      i18n:domain="eXtremeManagement"
      metal:use-macro="here/main_template/macros/master">

  <head>
      <metal:block fill-slot="top_slot">
        <span tal:replace="nothing"
              tal:define="dummy python:request.set('enable_border', 1)" />
      </metal:block>

      <metal:block fill-slot="css_slot">
        <style type="text/css" media="screen"
               tal:content="string: @import url($portal_url/eXtreme.css);">
        </style>
      </metal:block>
  </head>

  <body>

    <div metal:fill-slot="main"
         tal:define="totalActual python:here.getTotalActual();
                     totalEstimate python:here.getTotalEstimate();
                     item_path python:'/'.join(context.getPhysicalPath());
                     items python:here.portal_catalog.searchResults(portal_type='Task', 
                                                                    path=item_path);">

        <h1 tal:content="here/title_or_id" class="documentFirstHeading">
          Title or id
        </h1>

        <div class="documentDescription" 
             tal:condition="here/Description" 
             tal:content="here/Description">description
        </div>

        <div class="stx" tal:replace="structure here/CookedBody">
            body text
        </div>

        <div>
        <tal:block tal:condition="python:items and portal.portal_membership.getAuthenticatedMember().has_role(['Manager', 'Employee'])">

          <h1 class="documentFirstHeading" 
              i18n:translate="heading_tasks">Tasks</h1>

          <table class="listing"
                 border="1"
                 width="100%"
                 cellpadding="0" cellspacing="0">

             <thead>
               <tr>
                 <th i18n:translate="listingheader_desc">Description</th>
                 <th i18n:translate="listingheader_estimate">Estimate</th>                  
                 <th i18n:translate="listingheader_actual">Actual</th>
                 <th i18n:translate="listingheader_diff">Difference</th>
                 <th i18n:translate="listingheader_state">Status</th>
                 <th i18n:translate="listingheader_assignees">Assignee(s)</th>
               </tr>
             </thead>

               <tr tal:repeat="item items">
                <div tal:define="obj item/getObject;">
                 <td>
                   <a href=""
                      tal:attributes="href string:${obj/absolute_url}">
                      <span tal:content="obj/task">Task</span></a></td>
                 <td id="td-estimate" 
                     tal:content="obj/estimate">Estimate</td>
                 <td id="td-actual" 
                     tal:content="obj/getActual">Actual</td>
                 <td id="td-diff" 
                     tal:content="python: obj.estimate - obj.actual">Difference</td>
                 <td tal:define="wtool here/portal_workflow;
                                 review_state python:wtool.getInfoFor(obj, 'review_state')"
                     tal:content="review_state" i18n:translate="">Status</td>
                 <td>
                   <span tal:omit-tag="" tal:repeat="newItem obj/getAssignees">
                     <img src="user.gif"/>
                     <span tal:omit-tag="" tal:content="newItem">Assignee</span><br />
                     </span>
                 </td>
                </div>
               </tr>

               <tr class="totalTasks">
                 <td id="total" i18n:translate="total">Total</td>
                 <td id="total-estimate"
                     tal:content="totalEstimate">total estimate</td>
                 <td id="total-actual"
                     tal:content="totalActual">total actual</td>
                 <td id="total-diff" 
                     tal:content="python: totalEstimate - totalActual">total diff</td>
                 <td>&nbsp;</td>  
                 <td>&nbsp;</td>  
               </tr>

          </table>
        </tal:block>
        </div> 
   
        <p class="discreet"
           tal:condition="python: not items"
           i18n:translate="no_tasks_defined">No tasks defined yet.
        </p>
        
        <div tal:define="content_items python:here.contentValues('Document')"
             tal:condition="content_items">
           <h1 i18n:translate="heading-contents" 
               class="documentFirstHeading">Contents
           </h1>
           
           <tal:block tal:repeat="item content_items"><strong>
              <a href=""
                 tal:attributes="href string:${item/absolute_url}">
                 <span tal:content="item/title_or_id">Title</span>
              </a></strong>

              <div class="discreet"
                   tal:condition="here/Description" 
                   tal:content="item/Description">description
              </div><br />
           </tal:block>
        </div>
        
    </div>
  </body>
</html>
