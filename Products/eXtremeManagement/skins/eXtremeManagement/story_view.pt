<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      i18n:domain="eXtremeManagement">

    <metal:block use-macro="context/global_defines/macros/defines" />
    
    <body>
    <metal:block metal:define-macro="header">
        <h1 tal:content="here/title_or_id" class="documentFirstHeading">
            Title or id
        </h1>
        <div class="documentDescription" 
             tal:condition="here/Description" 
             tal:content="here/Description">description
        </div>
    </metal:block>
    
    <metal:block metal:define-macro="body"
                 tal:define="totalEstimate python:here.getTotalEstimate();
                        totalActual python:here.getTotalActual();
                        item_path python:'/'.join(context.getPhysicalPath());
                        items here/getFolderContents;">
    
        <div tal:replace="structure context/CookedBody" />

        <tal:block tal:condition="items">
            <h1 class="documentFirstHeading" 
                i18n:translate="heading_tasks">Tasks</h1>
    
            <table class="listing nosort"
                   border="1"
                   width="100%"
                   cellpadding="0" 
                   cellspacing="0">
                <thead>
                <tr>
                    <th i18n:translate="listingheader_title">Title</th>
                    <th i18n:translate="listingheader_estimate">Estimate</th>                  
                    <th i18n:translate="listingheader_actual">Actual</th>
                    <th i18n:translate="listingheader_diff">Difference</th>
                    <th i18n:translate="listingheader_state">Status</th>
                    <th i18n:translate="listingheader_assignees">Assignee(s)</th>
                </tr>
                </thead>
    
                <tr tal:repeat="item items"
                    class="list-in-iteration">
                <tal:block tal:define="taskObj item/getObject;">
                    <td class="td-story-title">
                        <a tal:attributes="href string:${taskObj/absolute_url}"
                           tal:content="taskObj/title">
                            Title
                        </a>
                    </td>
                    <td tal:content="taskObj/get_estimate_formatted">
                        estimate
                    </td>
                    <td tal:content="taskObj/get_actual_hours_formatted">
                        actual
                    </td>
                    <td tal:content="taskObj/get_difference_formatted">
                        diff
                    </td>
                   <td tal:define="wtool here/portal_workflow;
                            review_state python:wtool.getInfoFor(taskObj, 'review_state')"
                       tal:content="review_state"
                       class="td-center">
                        Status
                    </td>
                    <td class="td-center">
                        <span tal:omit-tag="" 
                              tal:repeat="newItem taskObj/getAssignees">
                            <img src="user.gif"
                                 alt="user" />
                            <span tal:replace="newItem">Assignee</span>
                            <br />
                        </span>
                    </td>
                </tal:block>
                </tr>
   
                <tr id="totalTasks">
                    <td class="td-story-title" 
                        i18n:translate="total">
                        Total
                    </td>
                    <td tal:content="totalEstimate">
                        total estimate
                    </td>
                    <td tal:content="totalActual">
                        total actual
                    </td>
                    <td tal:content="here/getTotalDifference">
                        total diff
                    </td>
                    <td>&nbsp;</td>  
                    <td>&nbsp;</td>  
                </tr>
            </table>
            </tal:block>
            
            <p class="discreet"
               tal:condition="python: not items"
               i18n:translate="no_tasks_defined">
                No tasks defined yet.
            </p>
            <br />
        </metal:block>

        <metal:block metal:define-macro="folderlisting" />
    </body>
</html>
