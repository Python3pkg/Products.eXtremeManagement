<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      i18n:domain="eXtremeManagement">

  <metal:block use-macro="context/global_defines/macros/defines" />
  <metal:block metal:use-macro="header" />
  
  <body>
    <metal:block metal:define-macro="body"
                 tal:define="totalEstimate python:here.getEstimate();
                             totalActual python:here.getActualHours();
                             totalDifference python:here.getDifference();
                             items context/getStateSortedContents;
                             path python:'/'.join(context.aq_parent.getPhysicalPath());
                             filter python:{'query': path, 'depth': 1};
                             stories python:context.portal_catalog({'path': filter});
                             num_stories python:len(stories);
                             pos context/getObjPositionInParent;
                             next python:pos &lt; num_stories-1 and stories[pos+1];
                             prev python:pos != 0 and stories[pos-1];
                             single_object python:not (next or prev);">

      <div class="listingBar"
           tal:condition="not:single_object">
        <a class="listingNext"
           tal:condition="python:next"
           tal:attributes="href next/getURL"
           tabindex="1"
           href="">
          <span i18n:translate="next">
            Next: </span>
          <span tal:replace="next/Title" /> 
          <img tal:replace="structure here/arrowRight.gif" />
        </a>
        <a class="listingPrevious"
           tal:condition="python:prev"
           tal:attributes="href prev/getURL"
           tabindex="1"
           href="">
          <img tal:replace="structure here/arrowLeft.gif" />
          <span i18n:translate="previous">
            Previous: </span>
          <span tal:replace="prev/Title" />
        </a>
          &nbsp;
      </div>

      <div class="documentDescription"
           tal:condition="here/Description"
           tal:content="here/Description">
        description
      </div>

      <div tal:replace="structure context/CookedBody" />

      <p tal:condition="context/getRoughEstimate"
         i18n:translate="label_roughestimate">
        Rough Estimate:
        <span i18n:name="rough" tal:replace="structure context/getRoughEstimate" />
        days.
      </p>

      <tal:block tal:condition="items">
        <h1 class="documentFirstHeading" 
            i18n:translate="heading_tasks">Tasks</h1>
        
        <metal:block metal:define-macro="tasklist_table">
          <table class="listing nosort"
                 border="1"
                 width="100%"
                 cellpadding="0" 
                 cellspacing="0">
            <metal:block metal:define-macro="tasklist_header">
              <thead>
                <tr>
                  <metal:block define-slot="extra_column_header"></metal:block>
                  <th i18n:translate="listingheader_title">Title</th>
                  <th i18n:translate="listingheader_estimate">Estimate</th>                  
                  <th i18n:translate="listingheader_actual">Actual</th>
                  <th i18n:translate="listingheader_diff">Difference</th>
                  <th i18n:translate="listingheader_state">Status</th>
                  <th i18n:translate="listingheader_assignees">Assignee(s)</th>
                </tr>
              </thead>
            </metal:block>


            <metal:block metal:define-macro="tasklist_body">
              <tr tal:repeat="task items"
                  tal:define="xt python:portal.xm_tool"
                  class="list-in-iteration">
                  <metal:block define-slot="extra_column_data"></metal:block>
                  <td class="td-story-title">
                    <a tal:attributes="href task/getURL"
                       tal:content="task/Title" />
                  </td>
                  <td tal:content="python:xt.formatTime(task.getRawEstimate)" />
                  <td tal:content="python:xt.formatTime(task.getRawActualHours)" />
                  <td tal:content="python:xt.formatTime(task.getRawDifference)" />
                  <td tal:content="task/review_state"
                      class="td-center" />
                  <td class="td-center">
                    <tal:assignees tal:repeat="newItem task/getAssignees">
                      <img tal:replace="structure context/user.gif" />
                      <span tal:replace="newItem">Assignee</span>
                      <br />
                    </tal:assignees>
                  </td>
              </tr>
            </metal:block>
            
            <metal:block define-slot="total_row">
              <tr id="totalTasks">
                <metal:block define-slot="extra_column_data"></metal:block>
                <td class="td-story-title" 
                    i18n:translate="total">
                  Total
                </td>
                <td tal:content="totalEstimate" />
                <td tal:content="totalActual" />
                <td tal:content="totalDifference" />
                <td>&nbsp;</td>  
                <td>&nbsp;</td>  
              </tr>
            </metal:block>
          </table>
        </metal:block>
      </tal:block>
      
      <p class="discreet"
         tal:condition="python: not items"
         i18n:translate="no_tasks_defined">
                No tasks defined yet.
            </p>
      <br />
        </metal:block>


        <metal:block metal:define-macro="folderlisting" />
    </body>
</html>
