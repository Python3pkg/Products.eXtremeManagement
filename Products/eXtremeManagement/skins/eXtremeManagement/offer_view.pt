<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="eXtremeManagement">

  <body>

    <div metal:fill-slot="main">
      <div metal:define-macro="body"
           tal:define="view context/@@iteration;
                       iteration view/main;
                       iteration_number string:1;
                       stories view/stories;">

        <div class="xm-details">

          <table class="listing"
                 width="100%"
                 cellpadding="0"
                 cellspacing="0">
            <tr>
              <th class="customer_info_header"
                  i18n:translate="listingheader_startdate">Start date</th>
              <td>
                <metal:field use-macro="python:here.widget('startDate',
                                        mode='view')">
                  Variable goes here
                </metal:field>
              </td>
            </tr>
            <tr>
              <th class="customer_info_header"
                  i18n:translate="listingheader_enddate">End date</th>
              <td>
                <metal:field use-macro="python:here.widget('endDate',
                                        mode='view')">
                  Variable goes here
                </metal:field>
              </td>
            </tr>

          </table>

          <div class="visualClear"><!-- --></div>
        </div>

        <p class="documentDescription">
          <metal:field use-macro="python:here.widget('description', mode='view')">
            Description
          </metal:field>
        </p>


        <div id="break-before-stories" class="visualClear"><!-- --></div>

        <tal:subitems tal:condition="stories">
          <h1 i18n:translate="heading-stories">Stories</h1>

          <metal:stories metal:define-macro="story_list">
            <table class="listing"
                   width="100%"
                   border="1"
                   cellpadding="0"
                   cellspacing="0">
              <metal:block define-slot="extra_header" />
              <tr>
                <th i18n:translate="listingheader_story">Story</th>
                <th i18n:translate="listingheader_initial_estimate">Initial estimate (days)</th>
              </tr>

              <tal:repeat repeat="story stories">
                <tr tal:define="number repeat/story/number"
                    tal:attributes="id string:toggle-header-${iteration_number}-${number}"
                    class="list-in-iteration">
                  <td class="td-story-title">
                    <div>
                      <a tal:attributes="href string:javascript:toggle_item('${iteration_number}-${number}')"
                         class="toggle-handle">[ &darr; ]</a>&nbsp;
                      <a class="storyTitle_iteration_overview"
                         tal:attributes="href string:${story/url}"
                         tal:content="story/title" />
                    </div>

                  </td>
                  <td tal:content="story/size_estimate" />
                </tr>
                <tr tal:define="number repeat/story/number"
                    tal:attributes="id string:toggle-item-${iteration_number}-${number}"
                    style="display:none"
                    class="toggle-item">
                  <td colspan="2">
                    <div>
                      <a tal:attributes="href string:javascript:toggle_item('${iteration_number}-${number}')"
                         class="toggle-handle">[ &uarr; ]</a>&nbsp;
                      <tal:details content="structure story/details" />
                    </div>
                  </td>
                </tr>
              </tal:repeat>

              <tr id="totalTasks">
                <th class="td-story-title"
                    i18n:translate="total">Total</th>
                <th tal:content="iteration/size_estimate" />
              </tr>
            </table>
          </metal:stories>
        </tal:subitems>

        <p class="discreet"
           tal:condition="python: not stories"
           i18n:translate="no_stories_published">
          No stories published yet!
        </p>
      </div>

      <metal:block metal:define-macro="folderlisting" />
    </div>
  </body>
</html>
