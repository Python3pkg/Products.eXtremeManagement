<html xmlns="http://www.w3.org/1999/xhtml"
      xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="extrememanagement">

<head>
<!--
    <metal:css fill-slot="css_slot">
        <style type="text/css" media="all"
               tal:content="string:@import url($portal_url/plonesoftwarecenter.css);"></style>
    </metal:css>
-->
    <metal:override fill-slot="column_two_slot" />

    <metal:block fill-slot="top_slot">
      <tal:noborder condition="python:not user.has_permission('Modify portal content', context)">
        <tal:noborderset tal:define="dummy python:request.set('disable_border', 1)" />
      </tal:noborder>
    </metal:block>
</head>

<body>

  <div metal:fill-slot="main"
       tal:define="global getInfoFor nocall:here/portal_workflow/getInfoFor;
                   catalog nocall:here/portal_catalog;
                   herePath python:'/'.join(here.getPhysicalPath())">
                   

    <h1 tal:content="here/title_or_id" class="documentFirstHeading">
      Title or id
    </h1>
    
    <div class="documentDescription"
         tal:content="here/Description">
      Description.
    </div>
    
    <p class="discreet">
    XXX make macros out of my issues and my tasks and reuse them
    in reported issus and created tasks portlet;
    
    navigation for items using javascript and display:None
    (similar to https://svn.lovelysystems.com/repos/customers/walser/walseralps/Walseralps/trunk/skins/Walseralps/portlet_articles.pt)
    
    </p>

    <dl class="portlet portletThirdWidth"
        tal:define="issues python:here.getFilteredIssues(onlyTodo=True, assignedToMe=True)">
        <dt class="portletHeader">
            <tal:comment tal:replace="nothing">
                XXX assigned to me is missing in rss query
            </tal:comment>
            <tal:syndicate condition="syntool/isSiteSyndicationAllowed">
                <a class="feedButton" href="" tal:attributes="href string:$here_url/search_rss?portal_type=PoiIssue&amp;sort_on=Date&amp;sort_order=reverse&amp;path=${herePath}&amp;review_state=open,in-progress,unconfirmed">
                   <img i18n:attributes="title title_rss_feed; alt label_rss_feed;"
                        tal:attributes="src string:$portal_url/rss.gif"
                        src="rss.gif"
                        alt="RSS Feed"
                        title="RSS feed of the issues assigned to me" />
                </a>
            </tal:syndicate>
            <tal:comment tal:replace="nothing">XXX what is the link for? (planned overviewtemplate?)</tal:comment>
            <a href=""
               tal:attributes="href string:${here/absolute_url}/xm_issues/by-category/my"
               i18n:translate="XXX_xm_myIssues">
                Issues assigned to me
            </a>                 
        </dt>
        

        <tal:issue_groups tal:repeat="issue issues">
            <dd class="portletItem" 
                tal:define="oddrow repeat/issue/odd;
                            review_state issue/review_state"
                tal:attributes="class python:test(oddrow, 'portletItem even', 'portletItem odd')">
                
                <a href=""
                   tal:attributes="href issue/getURL;
                                   title issue/Description;
                                   class string:state-$review_state">
                    <img tal:replace="structure here/PoiIssue.gif" />
                    <span tal:replace="issue/Title">Issue</span>
                </a>
                
                <p class="discreet"
                   tal:define="severity issue/getSeverity;
                               projectUrl string: XXX;
                               projectName string: XXX">
                    project: 
                      <a href="projectURL"
                         tal:attributes="href projectUrl"
                         class="XXX: no underline">
                        <span tal:replace="projectName"/>
                      </a>;
                    severity: <span tal:replace="severity"/>;
                    state: <span tal:replace="review_state"/>
                </p>
            </dd>   
        </tal:issue_groups>
        
        <tal:nolist condition="not: issues">
            <dd class="portletItem odd">
                <span class="discreet" i18n:translate="no_issues_found">
                    No issues found.
                </span>
            </dd>
        </tal:nolist>
                
        <dd class="portletFooter">
            navigation here
        </dd>
    </dl>
    
    <dl class="portlet portletThirdWidth"
        tal:define="tasks python:here.getFilteredTasks(assignedToMe=True,onlyTodo=True)">
        
        <dt class="portletHeader">
            <tal:comment tal:replace="nothing">
                XXX assigned to me is missing in rss query
            </tal:comment>
            <tal:syndicate condition="syntool/isSiteSyndicationAllowed">
                <a class="feedButton" href="" tal:attributes="href string:$here_url/search_rss?portal_type=Task&amp;sort_on=Date&amp;sort_order=reverse&amp;path=${herePath}&amp;review_state=to-do,open">
                   <img i18n:attributes="title title_rss_feed; alt label_rss_feed;"
                        tal:attributes="src string:$portal_url/rss.gif"
                        src="rss.gif"
                        alt="RSS Feed"
                        title="RSS feed of the issues assigned to me" />
                </a>
            </tal:syndicate>
            <tal:comment tal:replace="nothing">XXX what is the link for? (planned overviewtemplate?)</tal:comment>
            <a href=""
               tal:attributes="href string:${here/absolute_url}/xm_issues/by-category/my"
               i18n:translate="XXX_xm_myIssues">
                Tasks assigned to me
            </a>                 
        </dt>


        <tal:task_groups tal:repeat="task tasks">
            <dd class="portletItem" 
                tal:define="oddrow repeat/task/odd;
                            review_state task/review_state"
                tal:attributes="class python:test(oddrow, 'portletItem even', 'portletItem odd')">
                
                <a href=""
                   tal:attributes="href task/getURL;
                                   title task/Description;
                                   class string:state-$review_state">
                    <img tal:replace="structure here/task_icon.gif" />
                    <span tal:replace="task/Title">Issue</span>
                </a>
 
                <p class="discreet"
                   tal:define="obj task/getObject">
                    project:
                    <span tal:replace="python: obj.getProject().title_or_id()"/>
                    story:
                    <span tal:replace="python: obj.aq_parent.title_or_id()"/>;
                </p>

            </dd>   
        </tal:task_groups>
        
        <tal:nolist condition="not: tasks">
            <dd class="portletItem odd">
                <span class="discreet" i18n:translate="no_tasks_found">
                    No tasks found.
                </span>
            </dd>
        </tal:nolist>
                    
        
        <dd class="portletFooter">
            navigation here
        </dd>    
    </dl>
    

    
    <dl class="portlet portletThirdWidth">
        <dt class="portletHeader">
            <tal:comment tal:replace="nothing">
                XXX created by me is missing in rss query
            </tal:comment>
            <tal:syndicate condition="syntool/isSiteSyndicationAllowed">
                <a class="feedButton" href="" tal:attributes="href string:$here_url/search_rss?portal_type=Task&amp;sort_on=Date&amp;sort_order=reverse&amp;path=${herePath}&amp;review_state=to-do,open">
                   <img i18n:attributes="title title_rss_feed; alt label_rss_feed;"
                        tal:attributes="src string:$portal_url/rss.gif"
                        src="rss.gif"
                        alt="RSS Feed"
                        title="RSS feed of the issues assigned to me" />
                </a>
            </tal:syndicate>
            <tal:comment tal:replace="nothing">XXX what is the link for? (planned overviewtemplate?)</tal:comment>
            <a href=""
               tal:attributes="href string:${here/absolute_url}/xm_issues/by-category/my"
               i18n:translate="XXX_xm_myIssues">
                Tasks created by me
            </a>                 
        </dt>

        <dd class="portletItem odd">
        <p class="discrete">
        Click here to show all pending Tasks you created.
        </p>
        </dd>
        
        <dd class="portletFooter">
          navigation here
        </dd>
                
    </dl> 
     
    if possible, show portlet with pending issues below the tasks
    <div class="visualClear" />
   

  </div>

</body>
</html>
