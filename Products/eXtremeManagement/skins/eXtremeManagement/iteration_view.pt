<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      i18n:domain="eXtremeManagement">
    <metal:block use-macro="context/global_defines/macros/defines" />

    <body>
    <metal:block metal:define-macro="header">
        <h1 tal:content="here/title_or_id" 
            class="documentFirstHeading">
            Title or id
        </h1>
        <div class="discreet" 
            tal:content="here/Description">
            Description
        </div>
        <br />
        <table class="listing"
                border="1">
            <tr class="header_projectmember_listing">
                <th i18n:translate="listingheader_man_uren">Man hours</th>
                <th i18n:translate="listingheader_startdate">Start date</th>
                <th i18n:translate="listingheader_enddate">End date</th>
            </tr>
            <tr>
                <td tal:content="context/getManHours" />
                <td tal:content="python:context.toLocalizedTime(context.getStartDate(), long_format=0)" />
                <td tal:content="python:context.toLocalizedTime(context.getEndDate(), long_format=0)" />
            </tr>
        </table>
        <br />
    </metal:block>
    

    <metal:block metal:define-macro="body" 
                 tal:define="stories here/getFolderContents;">
    
        <tal:block tal:condition="stories">
            <h1 i18n:translate="heading-stories">Stories</h1>

            <table class="listing"
                width="100%"
                border="1"
                cellpadding="0"
                cellspacing="0">
    
                <tr>
                    <th i18n:translate="listingheader_story">Story</th>
                    <th i18n:translate="listingheader_state">Status</th>
                    <th i18n:translate="listingheader_estimate">Estimate</th>
                    <th i18n:translate="listingheader_actual">Actual</th>
                </tr>
    
                <tr tal:repeat="story stories"
                    class="list-in-iteration">
                    <tal:block tal:define="storyObj story/getObject">
                    <td class="td-story-title">
                        <a class="storyTitle_iteration_overview"
                        tal:attributes="href string:${storyObj/absolute_url}"
                        tal:content="storyObj/Title">
                            Title
                        </a>
                    </td>
                    <td tal:define="wtool here/portal_workflow;
                                    review_state python:wtool.getInfoFor(storyObj, 'review_state')"
                        tal:content="review_state"
                        class="td-center">
                        Status
                    </td>
                    <td tal:content="python:storyObj.getEstimate()">
                        Estimate
                    </td>
                    <td tal:content="python:storyObj.getActualHours()">
                        Actual
                    </td>
                    </tal:block>
                </tr>
                <tr id="totalTasks">
                    <td class="td-story-title"
                        colspan="2" 
                        i18n:translate="total">Total</td>
                    <td tal:define="totalEstimate python:here.getEstimate();"
                        tal:content="totalEstimate">Total estimate</td>
                    <td tal:define="totalActual python:here.getActualHours();"
                        tal:content="totalActual">Total actual</td>
                </tr>
            </table>





            <tal:block tal:define="results
                        python:context.getOwnInProgressTasks();">
            <tal:block tal:condition="results">
            <h1 i18n:translate="heading-in-progress-tasks">My in-progress tasks</h1>
            <table class="listing nosort"
                   border="1"
                   width="100%"
                   cellpadding="0" 
                   cellspacing="0">
                <thead>
                <tr>
                    <th i18n:translate="listingheader_story">Story</th>
                    <th i18n:translate="listingheader_title">Title</th>
                    <th i18n:translate="listingheader_estimate">Estimate</th>                  
                    <th i18n:translate="listingheader_actual">Actual</th>
                    <th i18n:translate="listingheader_diff">Difference</th>
                    <th i18n:translate="listingheader_co_assignees">Co-assignee(s)</th>
                </tr>
                </thead>
    
                <tr tal:repeat="taskObj results"
                    class="list-in-iteration">
                    <td class="td-story-title">
                        <a tal:attributes="href string:${taskObj/aq_parent/absolute_url}"
                           tal:content="taskObj/aq_parent/title">
                            Title
                        </a>
                    </td>
                    <td class="td-story-title">
                        <a tal:attributes="href string:${taskObj/absolute_url}"
                           tal:content="taskObj/title">
                            Title
                        </a>
                    </td>
                    <td tal:content="taskObj/getEstimate">
                        estimate
                    </td>
                    <td tal:content="taskObj/getActualHours">
                        actual
                    </td>
                    <td tal:content="taskObj/getDifference">
                        diff
                    </td>
                    <td class="td-center">
                        <span tal:omit-tag="" 
                              tal:repeat="newItem taskObj/getCoAssignees">
                            <img src="user.gif"
                                 alt="user" />
                            <span tal:replace="newItem">Assignee</span>
                            <br />
                        </span>
                    </td>
                </tr>
            </table>
            </tal:block>
            </tal:block>


            <tal:block tal:define="results python:context.getOwnAssignedTasks();">
            <tal:block tal:condition="results">
            <h1 i18n:translate="heading-in-progress-tasks">My assigned tasks</h1>
            <table class="listing nosort"
                   border="1"
                   width="100%"
                   cellpadding="0" 
                   cellspacing="0">
                <thead>
                <tr>
                    <th i18n:translate="listingheader_story">Story</th>
                    <th i18n:translate="listingheader_title">Title</th>
                    <th i18n:translate="listingheader_estimate">Estimate</th>                  
                    <th i18n:translate="listingheader_co_assignees">Co-assignee(s)</th>
                </tr>
                </thead>
    
                <tr tal:repeat="taskObj results"
                    class="list-in-iteration">
                    <td class="td-story-title">
                        <a tal:attributes="href string:${taskObj/aq_parent/absolute_url}"
                           tal:content="taskObj/aq_parent/title">
                            Title
                        </a>
                    </td>
                    <td class="td-story-title">
                        <a tal:attributes="href string:${taskObj/absolute_url}"
                           tal:content="taskObj/title">
                            Title
                        </a>
                    </td>
                    <td tal:content="taskObj/getEstimate">
                        estimate
                    </td>
                    <td class="td-center">
                        <span tal:omit-tag="" 
                              tal:repeat="newItem taskObj/getCoAssignees">
                            <img src="user.gif"
                                 alt="user" />
                            <span tal:replace="newItem">Assignee</span>
                            <br />
                        </span>
                    </td>
                </tr>
            </table>
            </tal:block>
            </tal:block>

        </tal:block>

        <p class="discreet" 
            tal:condition="python: not stories"
            i18n:translate="no_stories_published">
            No stories published yet!
        </p>
    </metal:block>

    <metal:block metal:define-macro="folderlisting" />

    </body>
</html>
