<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      i18n:domain="eXtremeManagement">
    <metal:block use-macro="context/global_defines/macros/defines" />
    <metal:block metal:use-macro="header" />

    <body>

    <metal:block metal:define-macro="body" 
                 tal:define="stories here/getStateSortedContents;
                             totalActual python:here.getActualHours();">
    
        <div class="documentDescription"
             tal:condition="here/Description"
             tal:content="here/Description">
            description
        </div>
        <table class="listing"
                border="1">
            <tr class="header_projectmember_listing">
                <th i18n:translate="listingheader_man_uren">Man hours</th>
                <th i18n:translate="listingheader_actual">Actual</th>
                <th i18n:translate="listingheader_startdate">Start date</th>
                <th i18n:translate="listingheader_enddate">End date</th>
            </tr>
            <tr>
                <td tal:content="context/getManHours" />
                <td tal:content="totalActual" />
                <td tal:content="python:context.toLocalizedTime(context.getStartDate(), long_format=0)" />
                <td tal:content="python:context.toLocalizedTime(context.getEndDate(), long_format=0)" />
            </tr>
        </table>
        <br />

        <tal:block tal:condition="stories">
            <h1 i18n:translate="heading-stories">Stories</h1>

            <table class="listing"
                width="100%"
                border="1"
                cellpadding="0"
                cellspacing="0">
    
                <tr>
                    <th i18n:translate="listingheader_story">Story</th>
                    <th i18n:translate="listingheader_state">Status</th>
                    <th i18n:translate="listingheader_estimate">Estimate</th>
                    <th i18n:translate="listingheader_actual">Actual</th>
                </tr>
    
                <tr tal:repeat="story stories"
                    class="list-in-iteration">
                    <tal:block tal:define="storyObj story/getObject">
                    <td class="td-story-title">
                        <a class="storyTitle_iteration_overview"
                        tal:attributes="href string:${storyObj/absolute_url}"
                        tal:content="storyObj/Title" />
                    </td>
                    <td tal:define="wtool here/portal_workflow;
                                    review_state python:wtool.getInfoFor(storyObj, 'review_state')"
                        tal:content="review_state"
                        class="td-center" />
                    <td tal:content="python:storyObj.getEstimate()" />
                    <td tal:content="python:storyObj.getActualHours()" />
                    </tal:block>
                </tr>
                <tr id="totalTasks">
                    <td class="td-story-title"
                        colspan="2" 
                        i18n:translate="total">Total</td>
                    <td tal:define="totalEstimate python:here.getEstimate();"
                        tal:content="totalEstimate" />
                    <td tal:content="totalActual" />
                </tr>
            </table>


            <tal:membertasks
                tal:define="membertasks python:context.getTotalTasksForAll();">
              <h1 i18n:translate="heading-hours-per-employee">
              Hours per employee</h1>
              <table class="listing"
                     border="1"
                     cellpadding="0"
                     cellspacing="0"
                     tal:condition="membertasks">
                
                <tr>
                  <th i18n:translate="listingheader_employee">Employee</th>
                  <th i18n:translate="listingheader_total_estimate">
                  Total Estimate</th>
                  <th i18n:translate="listingheader_total_actual">
                  Total Actual</th>
                  <th i18n:translate="listingheader_total_difference">
                  Total Difference</th>
                </tr>
                
                <tr tal:repeat="membertask membertasks"
                    tal:attributes="class string:list-in-iteration">
                  <tal:member
                      tal:define="memberid python:membertask[0];
                                  tot python:membertask[1];
                                  totalEstimate python:tot[0];
                                  totalActual python:tot[1];
                                  totalDifference python:tot[2];">
                    <td tal:content="memberid"
                        class="td-memberid" />
                    <td tal:content="totalEstimate" />
                    <td tal:content="totalActual" />
                    <td tal:content="totalDifference" />
                  </tal:member>
                </tr>
              </table>
            </tal:membertasks>

            <tal:block tal:define="items python:context.getOwnToDoTasks();">
            <tal:block tal:condition="items"
                       tal:define="tot python:context.getTotalOwnTasks('to-do');
                                   totalEstimate python:tot[0];
                                   totalActual python:tot[1];
                                   totalDifference python:tot[2];">
              <h1 i18n:translate="heading-in-progress-tasks">My to-do
              tasks</h1>
              <p i18n:translate="description-overview-my-tasks">
                Overview of tasks that belong to me.  The totals
                mentioned are the total time for myself, so they will
                usually differ from adding the numbers of the column
                above it.
              </p>
              
              <metal:block metal:define-macro="tasklist_table_with_story">
                <table metal:use-macro="here/story_view/macros/tasklist_table">
                    <metal:block fill-slot="extra_column_header">
                    <th i18n:translate="listingheader_story">Story</th></metal:block>
                    <metal:block fill-slot="extra_column_data">
                      <td tal:condition="task|nothing"
                          class="td-story-title">
                        <a tal:define="storyPath string:${task/getPath}/..;
                                       story     python:context.restrictedTraverse(storyPath);
                                       storyURL  string:${task/getURL}/..;"
                           tal:attributes="href storyURL"
                           tal:content="story/Title" />
                      </td>
                      <td tal:condition="not:task|nothing">
                      </td>
                    </metal:block>
                </table>
              </metal:block>
            </tal:block>
            </tal:block>


            <tal:block tal:define="items python:context.getOwnOpenTasks();">
            <tal:block tal:condition="items"
                       tal:define="tot python:context.getTotalOwnTasks('open');
                                   totalEstimate python:tot[0];
                                   totalActual python:tot[1];
                                   totalDifference python:tot[2];">
            <h1 i18n:translate="heading-open-tasks">My open tasks</h1>
               <table
               metal:use-macro="here/iteration_view/macros/tasklist_table_with_story">
               </table>
            </tal:block>
            </tal:block>

        </tal:block>

        <p class="discreet" 
            tal:condition="python: not stories"
            i18n:translate="no_stories_published">
            No stories published yet!
        </p>
    </metal:block>

    <metal:block metal:define-macro="folderlisting" />

    </body>
</html>
