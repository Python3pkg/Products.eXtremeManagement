<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      i18n:domain="eXtremeManagement">
  <metal:block use-macro="context/global_defines/macros/defines" />

  <metal:block metal:use-macro="header"/>

  <body onload="javascript:setFromState('hideRow0');">
    <metal:block
        metal:define-macro="body"
        tal:define="idIndex python:Iterator(pos=-1);
                    physical_path python: '/'.join(context.getPhysicalPath());
                    finished_iterations python:context.getIterations(('completed','invoiced',));
                    current_iterations python:context.getIterations(('in-progress',));
                    open_iterations python:context.getIterations(('new',))">

      <div class="documentDescription"
           tal:condition="here/Description"
           tal:content="here/Description">
        description
      </div>
      <dl id="finished_iterations"
          class="collapsible inline collapsedOnLoad"
          tal:condition="finished_iterations">
        <dt i18n:translate="heading_finished_iterations"
            class="collapsibleHeader">
        Finished Iterations</dt>

        <dd class="iterations collapsibleContent" 
            tal:repeat="iteration finished_iterations"> 

          <metal:block metal:define-macro="simple_iteration_list"
                       tal:define="obj iteration/getObject;
                                   idx idIndex/next;">

            <table class="listing"
                   width="100%"
                   cellpadding="0" 
                   cellspacing="0">
              
              <tr>
                <th width="60%" 
                    height="30" 
                    align="left" 
                    class="header_iteration">
                  <a  class="header_iteration_project_overview"
                      tal:attributes="href string:${obj/absolute_url}">

                    <img tal:attributes="src string:${here/portal_url}/${obj/getIcon}"
                         alt="project overview"
                         i18n:attributes="alt project_overview"/>
                    <span tal:replace="obj/Title" />
                  </a>
                </th>
                <th width="40%" 
                    class="iteration-state">
                  <span i18n:translate="status">status</span>:
                  <img tal:attributes="src string:${iteration/review_state}.gif;
                                       alt iteration/review_state" />
                </th> 
              </tr>
            </table>
            
          </metal:block>
        </dd>
      </dl> 

      <br />
      <br />

      <tal:block tal:condition="current_iterations">
        <h1 i18n:translate="heading_current_iterations">Current Iterations</h1>
        <div class="iterations"
             tal:repeat="curIteration current_iterations">

          <tal:block tal:define="obj curIteration/getObject;
                                 idx idIndex/next;">

            <table class="listing"
                   width="100%"
                   cellpadding="0"
                   cellspacing="0"
                   tal:attributes="onload string:javascript:setFromState('hideTable${idx}');">

              <tr>
                <th width="60%" 
                    height="30" 
                    align="left" 
                    class="header_iteration">
                  <a class="header_iteration_project_overview"
                     tal:attributes="href string:${obj/absolute_url}">
                    <img tal:attributes="src string:${here/portal_url}/${obj/getIcon};
                                         alt string:Project overview"/>
                    <span tal:replace="obj/Title">Title</span>
                  </a>
                </th>
                <th width="40%" 
                    class="iteration-state">
                  <span i18n:translate="status">status</span>:
                  <img tal:attributes="src string:${curIteration/review_state}.gif;
                                       alt curIteration/review_state" />
                </th>
              </tr>
              <tr>
                <td colspan="2"
                    class="iteration-description"
                    tal:content="obj/Description">Description </td>
              </tr>
            </table>

            <table class="listing"
                   width="100%"
                   cellpadding="0"
                   cellspacing="0"
                   tal:attributes="id string:hideTable${idx};">

              <tr tal:condition="python:obj.contentValues('Story')">
                <th i18n:translate="listingheader_story">Story</th>
                <th i18n:translate="listingheader_progress">Progress</th>
                <th i18n:translate="listingheader_tasks_open">Tasks open</th>
                <th i18n:translate="listingheader_tasks_completed">Tasks completed</th>
              </tr>

              <tr tal:define="stories obj/getStateSortedContents"
                  tal:repeat="story_brain stories">

                <tal:block
                    tal:define="story python:story_brain.getObject();
                                progress python:story.get_progress_perc();
                                openTasks python:story.getUnfinishedTaskCount();
                                completedTasks python:story.getCompletedTaskCount();
                                storyIsCompleted python:story.isCompleted()">
                  
                  <td width="30%">
                    <a class="storyTitle_project_overview"
                       tal:attributes="href story/absolute_url"
                       tal:content="story/Title">
                      Title
                    </a>
                  </td>
                  
                  <td class="progress_details" 
                      width="150">
                    <span class="progress_percentage"
                          tal:content="string:${progress} %">&nbsp;</span>
                    <br />
                    <div class="progress_bar">
                      <img tal:condition="storyIsCompleted"
                           src="progress-complete.gif" 
                           height="10" 
                           tal:attributes="width progress"
                           alt="progress bar"
                           i18n:attributes="alt progress_bar" />
                      <img tal:condition="not:storyIsCompleted"
                           src="progress.gif" 
                           height="10" 
                           tal:attributes="width progress"
                           alt="progress bar"
                           i18n:attributes="alt progress_bar" />
                    </div>
                  </td>
                  <td class="tasks"
                      tal:content="openTasks">
                    tasks open
                  </td>
                  <td class="tasks"
                      tal:content="completedTasks">
                    tasks completed
                  </td>
                </tal:block>
              </tr>
            </table>
          </tal:block>
        </div>
      </tal:block>

      <tal:block tal:condition="not:current_iterations">
        <p i18n:translate="heading_no_current_iterations"><strong>
          No Current Iterations</strong></p>
      </tal:block>

      <dl id="open_iterations"
          class="collapsible inline collapsedOnLoad"
          tal:condition="open_iterations">
        <dt i18n:translate="heading_open_iterations"
            class="collapsibleHeader">
        Open Iterations</dt>

        <dd class="iterations collapsibleContent" 
            tal:repeat="iteration open_iterations"> 

          <metal:block
              use-macro="context/project_view/macros/simple_iteration_list" />

        </dd>
      </dl>

      <br />
      <br />

      <dl id="non_iterations"
          class="collapsible inline collapsedOnLoad"
          tal:define="non_iterations context/getNonIterations;"
          tal:condition="non_iterations">
        <dt i18n:translate="heading_other_content"
            class="collapsibleHeader">
        Other Content</dt>
        <dd tal:attributes="class python:'visualIcon contenttype-' + ni.portal_type.lower() + ' collapsibleContent';" 
            tal:repeat="ni non_iterations">
          <div class="visualIconPadding">
            <a tal:attributes="href ni/id;"
               tal:content="ni/Title"/>
          </div>
        </dd>
      </dl>

    </metal:block>

    <metal:block metal:define-macro="folderlisting" />

  </body>
</html>
