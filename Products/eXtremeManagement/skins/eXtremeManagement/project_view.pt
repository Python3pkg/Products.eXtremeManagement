<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="eXtremeManagement">

<head>
      <metal:block metal:fill-slot="javascript_head_slot">
        <script type="text/javascript"
          tal:attributes="src string:$portal_url/project.js"></script>
        <script type="text/javascript"
          tal:attributes="src string:$portal_url/coordinates.js"></script>
        <script type="text/javascript"
          tal:attributes="src string:$portal_url/drag.js"></script>
        <script type="text/javascript"
          tal:attributes="src string:$portal_url/dragdrop.js"></script>
      </metal:block>

<!--
<style type="text/css">
#phonetic {
	position: absolute;
	left: 10px;
	top: 10px;
}

#numeric {
	position: absolute;
	right: 10px;
	top: 50px;
	border: 1px solid white;
}
</style>
-->

<link rel="stylesheet" href="lists.css" type="text/css"/>
<script language="JavaScript" type="text/javascript" src="coordinates.js"></script>
<script language="JavaScript" type="text/javascript" src="drag.js"></script>
<script language="JavaScript" type="text/javascript" src="dragdrop.js"></script>

<script language="JavaScript" type="text/javascript"><!--
	window.onload = function() {
		var list = document.getElementById("phonetic");
		DragDrop.makeListContainer( list );
		list.onDragOver = function() { this.style["background"] = "#EEF"; };
		list.onDragOut = function() {this.style["background"] = "none"; };
		
		list = document.getElementById("numeric");
		DragDrop.makeListContainer( list );
		list.onDragOver = function() { this.style["border"] = "1px dashed #AAA"; };
		list.onDragOut = function() {this.style["border"] = "1px solid white"; };
	};
	//-->
</script>
</head>

<body onload="javascript:setFromState('hideRow0');">

    <div metal:fill-slot="main"
         tal:define="idIndex python:Iterator(pos=-1);
                     physical_path python: '/'.join(context.getPhysicalPath());
                     iterations python:here.portal_catalog.searchResults(portal_type='Iteration',
                                                                         review_state=['completed', 
                                                                                       'in-progress'], 
                                                                         path=physical_path);">

        <h1 tal:content="here/title_or_id" class="documentFirstHeading">
            Title or id
        </h1>
	
        <div class="documentDescription" tal:content="here/Description">
            description
        </div>


        <tal:block tal:condition="iterations">
         <h1 class="">Iterations</h1>

          <div class="iterations" 
               tal:repeat="iteration iterations"> 

           <div tal:define="obj iteration/getObject;
                            idx idIndex/next;">

            <table id="sortable"
                   class="listing"
                   border="1"
                   width="70%"
                   cellpadding="0" 
                   cellspacing="0"
                   tal:attributes="onload string:javascript:setFromState('hideTable${idx}');">
            
              <tr>
                <th width="60%">        
                  <img src="treeCollapsed.gif"
                       tal:attributes="onclick string:javascript:toggleId('hideTable${idx}');" />

                  <a href=""
                     tal:attributes="href string:${obj/absolute_url}">
                    <img src="#"
                         tal:attributes="src string:${here/portal_url}/${obj/getIcon}"/>
                      <span tal:replace="obj/Title">Title</span>
                  </a>
                </th>
                <th width="40%" id="iteration-state">status: 
                    <!-- <span tal:content="iteration/review_state">Status</span> -->
                    <img src="#" tal:attributes="src string:${iteration/review_state}.gif" />
                </th> 
              </tr>
              <tr>
                 <td colspan="2" 
                     tal:content="obj/Description">Description </td>
              </tr>
            </table>
              
            <table class="listing" 
                   width="70%" 
                   border="1"
                   cellpadding="0" 
                   cellspacing="0"
                   tal:attributes="id string:hideTable${idx};">

              <tr tal:condition="python:obj.contentValues('Story')">
                <th i18n:translate="">Story</th>
                <th i18n:translate="">Progress</th>
                <th i18n:translate="">Tasks open</th>
                <th i18n:translate="">Tasks completed</th>
              </tr>
 
              <tr tal:define="iteration_path python:'/'.join(obj.getPhysicalPath());
                              stories python:here.portal_catalog.searchResults(portal_type='Story',
                                                                               sort_order='traverse',
                                                                               review_state=['completed', 'in-progress', 'assigned'],
                                                                               path=iteration_path);"
                  tal:condition="stories"
                  tal:repeat="story stories">

                <div tal:define="storyObj story/getObject;
                                 progress python:here.getProgress(storyObj);
                                 openTasks python:here.getOpenTasks(storyObj);
                                 completedTasks python:here.getCompletedTasks(storyObj)">

                  <td width="30%"> 
                    <a href="" 
                       tal:attributes="href string:${storyObj/absolute_url}">
                       <span tal:content="storyObj/Title">Title</span></a></td>

                  <td id="progress_details" width="150">
                   <span id="progress_percentage" 
                         tal:content="python:str(progress) + '%'">&nbsp;</span><br />
                    <div id="progress_bar"> 
                       <img src="progress.gif" 
                            height="10" 
                            width="" 
                            tal:attributes="width progress"/></div></td> 
                  <td id="open_tasks" 
                      tal:content="openTasks">tasks open</td>
                  <td id="completed_tasks" 
                      tal:content="completedTasks">tasks completed</td>
                       
                </div>                 
              </tr>
            </table> 

           </div>
          </div>
        </tal:block>


        <tal:block>
         <h1>Assign stories to iterations</h1>

         <p i18n:translate="">
           Here you can assign stories to an iteration. 
           Left are the stories and right the iterations. <br />
           Just drag a story and drop it under the iteration.
           A story can be assigned to 1 iteration only.
         </p>

         <table class="listing">
           <tr>
             <th>stories</th>
             <th>Iterations</th>
           </tr>
           <tr>
             <td>
               <ul tal:define="items python:here.portal_catalog.searchResults(portal_type='Story',)" 
                   id="phonetic" class="sortable boxy" style="margin-left: 1em;">
	         <li tal:repeat="item items"
                     tal:content="item/Title">Alpha</li>

               </ul> 
             </td>
             <td>
               <ul tal:define="items python:here.portal_catalog.searchResults(portal_type='Iteration',)"
                   id="numeric" class="sortable boxier" style="margin-right: 1em;">
                 <li tal:repeat="item items"
                     tal:content="item/Title">Alpha</li>

               </ul>
             </td>
           </tr>
         </table>
        </tal:block>


        <tal:block tal:define="stories python:here.portal_catalog.searchResults(portal_type='Story', 
                                                                                review_state='open',)"
                   tal:condition="stories">
          <h1 i18n:translate="">Stories not estimated</h1>
          
          <p i18n:translate="">
             These stories are not estimated yet. 
             After estimating these stories, they get the status "estimated" <br />
             and will be visible in the list above to be assigned to an iteration.
          </p>

          <ul class="stories_not_estimated">
             <li tal:repeat="story stories">
              <a href="" 
                 tal:attributes="href story/getURL" 
                 tal:content="story/Title">
              </a> </li>
          </ul>
        </tal:block>
            


    </div>
</body>
</html>
