<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="eXtremeManagement">

<head>
      <metal:block metal:fill-slot="javascript_head_slot">
        <script type="text/javascript"
          tal:attributes="src string:$portal_url/project.js"></script>
      </metal:block>
  
      <metal:block fill-slot="css_slot">
        <style type="text/css" media="screen"
               tal:content="string: @import url($portal_url/eXtreme.css);">
        </style>
      </metal:block>
</head>

<body onload="javascript:setFromState('hideRow0');">

    <div metal:fill-slot="main"
         tal:define="idIndex python:Iterator(pos=-1);
                     physical_path python: '/'.join(context.getPhysicalPath());
                     iterations python:here.portal_catalog.searchResults(portal_type='Iteration',
                                                                         review_state='completed', 
                                                                         path=physical_path);
                     current_iterations python:here.portal_catalog.searchResults(portal_type='Iteration',
                                                                                 sort_on='created',
                                                                                 sort_order='normal',
                                                                                 review_state='in-progress',
                                                                                 path=physical_path)[:1]">

        <h1 tal:content="here/title_or_id" class="documentFirstHeading">
            Title or id
        </h1>
	
        <div class="documentDescription" tal:content="here/Description">
            description
        </div>


        <tal:block tal:condition="iterations">
         <h1 class="" i18n:translate="heading_iterations">Iterations</h1>

          <div class="iterations" 
               tal:repeat="iteration iterations"> 

           <div tal:define="obj iteration/getObject;
                            idx idIndex/next;">

            <table class="listing"
                   border="1"
                   width="100%"
                   cellpadding="0" 
                   cellspacing="0"
                   tal:attributes="onload string:javascript:setFromState('hideTable${idx}');">
            
              <tr>
                <th width="60%" height="30">        
                  <img src="treeCollapsed.gif"
                       tal:attributes="onclick string:javascript:toggleId('hideTable${idx}');" />

                  <a href=""
                     id="header_iteration_project_overview"
                     tal:attributes="href string:${obj/absolute_url}">
                    <img src="#"
                         tal:attributes="src string:${here/portal_url}/${obj/getIcon}"/>
                      <span tal:replace="obj/Title">Title</span>
                  </a>
                </th>
                <th width="40%" id="iteration-state">status: 
                    <img src="#" tal:attributes="src string:${iteration/review_state}.gif" />
                </th> 
              </tr>
              <tr>
                 <td colspan="2" 
                     tal:content="obj/Description">Description </td>
              </tr>
            </table>
              
            <table class="listing" 
                   width="100%" 
                   border="0"
                   cellpadding="0" 
                   cellspacing="0"
                   tal:attributes="id string:hideTable${idx};">

              <tr tal:condition="python:obj.contentValues('Story')">
                <th i18n:translate="listingheader_story">Story</th>
                <th i18n:translate="listingheader_progress">Progress</th>
                <th i18n:translate="listingheader_tasks_open">Tasks open</th>
                <th i18n:translate="listingheader_tasks_completed">Tasks completed</th>
              </tr>
 
              <tr tal:define="iteration_path python:'/'.join(obj.getPhysicalPath());
                              stories python:here.portal_catalog.searchResults(portal_type='Story',
                                                                               sort_order='traverse',
                                                                               review_state=['completed', 
                                                                                             'in-progress', 
                                                                                             'assigned'],
                                                                               path=iteration_path);"
                  tal:condition="stories"
                  tal:repeat="story stories">

                <div tal:define="storyObj story/getObject;
                                 progress python:here.getProgress(storyObj);
                                 openTasks python:here.getOpenTasks(storyObj);
                                 completedTasks python:here.getCompletedTasks(storyObj)">

                  <td width="30%"> 
                    <a href="" 
                       id="storyTitle_project_overview"
                       tal:attributes="href string:${storyObj/absolute_url}">
                       <span tal:content="storyObj/Title">Title</span></a></td>

                  <td id="progress_details" width="150">
                   <span id="progress_percentage" 
                         tal:content="python:str(progress) + '%'">&nbsp;</span><br />
                    <div id="progress_bar"> 
                       <img src="progress.gif" 
                            height="10" 
                            width="" 
                            tal:attributes="width progress"/></div></td> 
                  <td id="open_tasks" 
                      tal:content="openTasks">tasks open</td>
                  <td id="completed_tasks" 
                      tal:content="completedTasks">tasks completed</td>
                       
                </div>                 
              </tr>
            </table> 

           </div>
          </div>
        </tal:block>


        <tal:block tal:condition="current_iterations">
          <div class="iterations"
               tal:repeat="curIteration current_iterations">

           <div tal:define="obj curIteration/getObject;
                            idx idIndex/next;">

            <table class="listing"
                   border="0"
                   width="100%"
                   cellpadding="0"
                   cellspacing="0"
                   tal:attributes="onload string:javascript:setFromState('hideTable${idx}');">

              <tr>
                <th width="60%" height="30">
                  <img src="treeCollapsed.gif"
                       tal:attributes="onclick string:javascript:toggleId('hideTable${idx}');" />

                  <a href=""
                     id="header_iteration_project_overview"
                     tal:attributes="href string:${obj/absolute_url}">
                    <img src="#"
                         tal:attributes="src string:${here/portal_url}/${obj/getIcon}"/>
                      <span tal:replace="obj/Title">Title</span>
                  </a>
                </th>
                <th width="40%" id="iteration-state">status:
                    <img src="#" tal:attributes="src string:${curIteration/review_state}.gif" />
                </th>
              </tr>
              <tr>
                 <td colspan="2"
                     tal:content="obj/Description">Description </td>
              </tr>
            </table>

            <table class="listing"
                   width="100%"
                   border="0"
                   cellpadding="0"
                   cellspacing="0"
                   tal:attributes="id string:hideTable${idx};">

              <tr tal:condition="python:obj.contentValues('Story')">
                <th i18n:translate="listingheader_story">Story</th>
                <th i18n:translate="listingheader_progress">Progress</th>
                <th i18n:translate="listingheader_tasks_open">Tasks open</th>
                <th i18n:translate="listingheader_tasks_completed">Tasks completed</th>
              </tr>

              <tr tal:define="iteration_path python:'/'.join(obj.getPhysicalPath());
                              stories python:here.portal_catalog.searchResults(portal_type='Story',
                                                                               sort_order='traverse',
                                                                               review_state=['completed',
                                                                                             'in-progress',
                                                                                             'assigned'],
                                                                               path=iteration_path);"
                  tal:condition="stories"
                  tal:repeat="story stories">

                <div tal:define="storyObj story/getObject;
                                 progress python:here.getProgress(storyObj);
                                 openTasks python:here.getOpenTasks(storyObj);
                                 completedTasks python:here.getCompletedTasks(storyObj)">

                  <td width="30%">
                    <a href=""
                       id="storyTitle_project_overview"
                       tal:attributes="href string:${storyObj/absolute_url}">
                       <span tal:content="storyObj/Title">Title</span></a></td>

                  <td id="progress_details" width="150">
                   <span id="progress_percentage"
                         tal:content="python:str(progress) + '%'">&nbsp;</span><br />
                    <div id="progress_bar">
                       <img src="progress.gif"
                            height="10"
                            width=""
                            tal:attributes="width progress"/></div></td>
                  <td id="open_tasks"
                      tal:content="openTasks">tasks open</td>
                  <td id="completed_tasks"
                      tal:content="completedTasks">tasks completed</td>

                </div>
              </tr>
            </table>

           </div>
          </div>
        </tal:block>


        <tal:block tal:define="open_iterations python:here.portal_catalog.searchResults(portal_type='Iteration',
                                                                                        review_state='open')"
                   tal:condition="iterations">
           <h1 i18n:translate="header_new_iterations">New iterations</h1>
           <p i18n:translate="">
              Here are 2 lists of iterations. Left you see new iterations and the stories in that iteration.
              Right you see a list of iterations ready to work in. When de current iteration is completed, 
              the first one will then the current one.
           </p> 
 
           <table class="listing" width="70%">
             <tr>
               <th i18n:translate="headerlisting_new_iterations">New iterations</th>
               <th i18n:translate="headerlisting_iterations_activated">Iteration activated</th>
             </tr>

             <tr>
               <td>
                 <div class="list_iterations">
                   <div tal:repeat="iteration open_iterations">
                     <img src=""
                          tal:attributes="src iteration/getIcon" />
                     <a href=""
                        tal:attributes="href iteration/getURL"
                        tal:content="iteration/Title">Title
                     </a>

                     <div style="display:normal;" class="list_iterations"
                          tal:define="stories python:iteration.getObject().contentValues('Story')">
                       <div tal:repeat="story stories">
                         <img src=""
                              tal:attributes="src story/getIcon" />
                         <a href=""
                            tal:attributes="href story/absolute_url"
                            tal:content="story/Title">Title
                         </a>
                       </div>
                     </div>

                   </div>
                 </div>
               </td>
               <td width="30%"
                   tal:define="iterations python:here.portal_catalog.searchResults(portal_type='Iteration',
                                                                                   review_state='activated',
                                                                                   sort_on='created',
                                                                                   sort_order='normal')"
                   tal:condition="iterations">
                  <div class="list_iterations">
                     <div tal:repeat="iteration iterations">
                        <img src="" 
                             tal:attributes="src iteration/getIcon" /> 
                        <a href=""
                           tal:attributes="href iteration/getURL"
                           tal:content="iteration/Title">Title
                        </a>
                     </div>
                  </div>
               </td>
             </tr>
           </table>
        </tal:block>


        <tal:block tal:define="project_path python:'/'.join(here.getPhysicalPath());
                               stories python:here.portal_catalog.searchResults(portal_type='Story', 
                                                                                review_state='open',
                                                                                path=project_path);
                               stories_estimated python:here.portal_catalog.searchResults(portal_type='Story',
                                                                                          review_state='estimated',
                                                                                          path=project_path)"
                   tal:condition="python:stories or stories_estimated">
           <h1 i18n:translate="header_stories_(not)_estimated">Stories (not) estimated</h1>
          
           <p i18n:translate="">
              These stories are not estimated yet. 
              After estimating these stories, they get the status "estimated" <br />
              and will be visible in the list above to be assigned to an iteration.
           </p>
       
           <table class="listing" width="60%">
             <tr>
               <th tal:condition="stories" 
                   i18n:translate="stories_not_estimated">Stories not estimated</th>
               <th tal:condition="stories_estimated" 
                   i18n:translate="stories_estimated">Stories estimated</th>
             </tr>

             <tr>
               <td tal:condition="stories">
                 <div tal:repeat="story stories">
                   <img src=""
                        tal:attributes="src story/getIcon" />
                   <a href=""
                      tal:attributes="href story/getURL"
                      tal:content="story/Title">Title
                   </a>
                 </div>
               </td>
              
               <td tal:condition="stories_estimated">
                 <div tal:repeat="story_es stories_estimated">
                   <img src=""
                        tal:attributes="src story_es/getIcon" />
                   <a href=""
                      tal:attributes="href story_es/getURL"
                      tal:content="story_es/Title">Title
                   </a>
                 </div>
               </td>
             </tr>
          </table>
        </tal:block>

    </div>
</body>
</html>
