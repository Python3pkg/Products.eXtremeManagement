<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">

<head>
<script>

//cookie functions from http://www.webmasterbase.com/static/popjs.php
function getCookieVal (offset) {
var endstr = document.cookie.indexOf (";", offset);
if (endstr == -1)
endstr = document.cookie.length;
return unescape(document.cookie.substring(offset, endstr));
}

function GetCookie (name) {
var arg = name + "=";
var alen = arg.length;
var clen = document.cookie.length;
var i = 0;
while (i < clen) {
var j = i + alen;
if (document.cookie.substring(i, j) == arg)
return getCookieVal (j);
i = document.cookie.indexOf(" ", i) + 1;
if (i == 0)
break;
}
return null;
}

function SetCookie (name, value) {
var argv = SetCookie.arguments;
var argc = SetCookie.arguments.length;
var expires = (2 < argc) ? argv[2] : null;
var path = (3 < argc) ? argv[3] : null;
var domain = (4 < argc) ? argv[4] : null;
var secure = (5 < argc) ? argv[5] : false;
document.cookie = name + "=" + escape (value) +
((expires == null) ? "" : ("; expires=" + expires.toGMTString())) +
((path == null) ? "" : ("; path=" + path)) +
((domain == null) ? "" : ("; domain=" + domain)) +
((secure == true) ? "; secure" : "");
}

var rowShow=(document.all?'block':'table-row');

function toggleRows(prefix) {
    var el,i,state;
    for (i=0; el=document.getElementById(prefix+i); i++) {
        state=('none'==el.style.display?1:0);
        el.style.display=(state?rowShow:'none');
    }
    SetCookie('rowShowState'+prefix, state);
}

function setFromState(prefix) {
    var el,i,state=GetCookie('rowShowState'+prefix)*1;
    for (i=0; el=document.getElementById(prefix+i); i++) {
        el.style.display=(state?rowShow:'none');
    }
}
</script>
</head>


<body onload="javascript:setFromState('hideRow');">

    <div metal:fill-slot="main"
         tal:define="physical_path python: '/'.join(context.getPhysicalPath());
                     iterations python:here.portal_catalog.searchResults(portal_type='Iteration', 
                                                                         path=physical_path);">

        <h1 tal:content="here/title_or_id" class="documentFirstHeading">
            Title or id
        </h1>
	
        <div class="documentDescription" tal:content="here/Description">
            description
        </div>




        <tal:block tal:condition="iterations">
          <h1 class="">Iterations</h1>

          <div class="iterations" 
               tal:repeat="iteration iterations"> 

            <button onclick="javascript:toggleRows('hideRow');">Toggle rows</button>

            <table id="sortable"
                   class="listing"
                   border="1"
                   width="60%"
                   cellpadding="0" cellspacing="0"
                   tal:define="obj iteration/getObject;">

              <tr>
                <th>
                  <a href=""
                     tal:attributes="href string:${obj/absolute_url}">
                    <img src="#"
                         tal:attributes="src string:${here/portal_url}/${obj/getIcon}"/>
                      <span tal:replace="obj/Title">Title</span>
                  </a>
                </th>
                <th id="iteration-state" 
                    colspan="3">status: <span tal:content="iteration/review_state">Status</span></th> 
              </tr>

              <div tal:define="iteration_path python:'/'.join(obj.getPhysicalPath());
                               stories python:here.portal_catalog.searchResults(portal_type='Story',
                                                                                path=iteration_path);"
                   tal:condition="stories"
                   tal:repeat="story stories">

                <tr id="hideRow0">
                   <td> 
                      <a href="" 
                         tal:attributes="href string:${story/absolute_url}">
                         <span tal:content="story/Title">Title</span></a></td>
                   <td>progress</td>
                   <td>tasks open</td>
                   <td>tasks completed</td>
                </tr> </div>
            </table> 

          </div>
        </tal:block>

    </div>
</body>
</html>
