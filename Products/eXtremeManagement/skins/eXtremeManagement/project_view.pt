<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="eXtremeManagement">

<head>
      <metal:block metal:fill-slot="javascript_head_slot">
        <script type="text/javascript"
          tal:attributes="src string:$portal_url/project.js"></script>
      </metal:block>
</head>

<body onload="javascript:setFromState('hideRow0');">

    <div metal:fill-slot="main"
         tal:define="idIndex python:Iterator(pos=-1);
                     physical_path python: '/'.join(context.getPhysicalPath());
                     iterations python:here.portal_catalog.searchResults(portal_type='Iteration',
                                                                         review_state=['completed', 'in-progress'], 
                                                                         path=physical_path);">

        <h1 tal:content="here/title_or_id" class="documentFirstHeading">
            Title or id
        </h1>
	
        <div class="documentDescription" tal:content="here/Description">
            description
        </div>


        <tal:block tal:condition="iterations">
         <h1 class="">Iterations</h1>

          <div class="iterations" 
               tal:repeat="iteration iterations"> 

           <div tal:define="obj iteration/getObject;
                            idx idIndex/next;">

            <table id="sortable"
                   class="listing"
                   border="1"
                   width="70%"
                   cellpadding="0" 
                   cellspacing="0"
                   tal:attributes="onload string:javascript:setFromState('hideTable${idx}');">
            
              <tr>
                <th width="60%">        
                  <img src="treeCollapsed.gif"
                       tal:attributes="onclick string:javascript:toggleId('hideTable${idx}');" />

                  <a href=""
                     tal:attributes="href string:${obj/absolute_url}">
                    <img src="#"
                         tal:attributes="src string:${here/portal_url}/${obj/getIcon}"/>
                      <span tal:replace="obj/Title">Title</span>
                  </a>
                </th>
                <th width="40%" id="iteration-state">status: 
                    <span tal:content="iteration/review_state">Status</span>
                </th> 
              </tr>
              <tr>
                 <td colspan="2" 
                     tal:content="obj/Description">Description </td>
              </tr>
            </table>
              
            <table class="listing" 
                   width="70%" 
                   border="1"
                   cellpadding="0" 
                   cellspacing="0"
                   tal:attributes="id string:hideTable${idx};">

              <tr tal:condition="python:obj.contentValues('Story')">
                <th i18n:translate="">Title</th>
                <th i18n:translate="">Progress</th>
                <th i18n:translate="">Tasks open</th>
                <th i18n:translate="">Tasks completed</th>
              </tr>
 
              <tr tal:define="iteration_path python:'/'.join(obj.getPhysicalPath());
                              stories python:here.portal_catalog.searchResults(portal_type='Story',
                                                                               sort_order='traverse',
                                                                               review_state=['completed', 'in-progress', 'assigned'],
                                                                               path=iteration_path);"
                  tal:condition="stories"
                  tal:repeat="story stories">

                <div tal:define="storyObj story/getObject;
                                 progress python:here.getProgress(storyObj);
                                 openTasks python:here.getOpenTasks(storyObj);
                                 completedTasks python:here.getCompletedTasks(storyObj)">

                  <td width="30%"> 
                    <a href="" 
                       tal:attributes="href string:${storyObj/absolute_url}">
                       <span tal:content="storyObj/Title">Title</span></a></td>

                  <td id="progress_details" width="150">
                   <span id="progress_percentage" 
                         tal:content="python:str(progress) + '%'">&nbsp;</span><br />
                    <div id="progress_bar"> 
                       <img src="progress.gif" 
                            height="10" 
                            width="" 
                            tal:attributes="width progress"/></div></td> 
                  <td id="open_tasks" 
                      tal:content="openTasks">tasks open</td>
                  <td id="completed_tasks" 
                      tal:content="completedTasks">tasks completed</td>
                       
                </div>                 
              </tr>
            </table> 

           </div>
          </div>
        </tal:block>

        <table class="listing" 
               border="1" 
               tal:define="stories python:here.portal_catalog.searchResults(portal_type='Story',
                                                                            review_state=['open', 'estimated'],);
                           iterations python:here.portal_catalog.searchResults(portal_type='Iteration',
                                                                               review_state='open')">
          <tr>
            <th>stories</th>
            <th>buttons</th>
            <th>iterations</th>
          </tr>
         
          <tr>
            <td>
               <select name="stories:list"
                       id="stories"
                       multiple="multiple"
                       tabindex=""
                       tal:attributes="tabindex tabindex/next;">
                  <option tal:repeat="story stories"
                          tal:attributes="value story"
                          tal:content="story/Title"
                          i18n:translate="">
                          Story name
                  </option>
               </select>
            </td>
   
            <td> >> <br /><br /> << </td>
            <td>               
               <select name="iterations:list"
                       id="iterations"
                       multiple="multiple"
                       tabindex=""
                       tal:attributes="tabindex tabindex/next;">
                  <option tal:repeat="iteration iterations"
                          tal:attributes="value iteration"
                          tal:content="iteration/Title"
                          i18n:translate="">
                          Iteration name
                  </option>

                  <optgroup label="Iteration" tal:define="objects python:here.contentValues()">  
                     <option tal:repeat="obj objects"
                             tal:attributes="value obj"
                             tal:content="obj/Title"> Story name
                     </option>
                  </optgroup>
                  
               </select>
            </td>
          </tr>
        </table>

        <tal:block tal:define="stories python:here.portal_catalog.searchResults(portal_type='Story', 
                                                                                review_state='open',)"
                   tal:condition="stories">
          <h1 i18n:translate="">Stories to be estimated</h1>
          <div tal:repeat="story stories">
              <a href="" 
                 tal:attributes="href story/getURL" 
                 tal:content="story/Title">
              </a>
          </div>
        </tal:block>
            


    </div>
</body>
</html>
